---
import PostItem from "../components/ui/PostItem";
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";
import { getImage } from "astro:assets";

const allProjects = await getCollection("projects");
allProjects.sort((a, b) => {
  const dateA = Date.parse(a.data.date);
  const dateB = Date.parse(b.data.date);
  return dateA > dateB? -1 : dateA < dateB? 1 : 0;
});
async function getOptimizedProjectImage(image) {
  return await getImage({src: image, width: 1080, height: 1080, format: "webp"})
}

const colours = ["#ff0000", "#00ff00", "#0000ff"];
---

<Layout title="dukc :: projects">
  <script>
    import { gsap } from "gsap"; 

    document.addEventListener("DOMContentLoaded", () => {
      gsap.from(".post-item", {
        duration: 1,
        scale: 0.75,
        opacity: 0,
        stagger: 0.05,
        ease: "power4.out",
      });
  });
  </script>
  <div class="bg-black w-full h-fit flex items-center justify-center">
    <h1 class="font-serif text-[26vw] leading-[120%]">projects</h1>
  </div>
  <div class="flex flex-col gap-12 p-32 max-[750px]:px-0 min-h-screen">
    {
      allProjects.map(async (project, index) => {
        const colour = colours[index % colours.length];
        return (
          <div class="w-full h-fit group post-item">
            <PostItem
              title={project.data.title}
              description={project.data.description}
              link={`/project/${project.slug}`}
              colour={colour}
            />
            <img
              src={(await getOptimizedProjectImage(project.data.image)).src}
              alt={project.data.title}
              class="absolute pointer-events-none group-hover:opacity-100 opacity-0 duration-150 ease-out aspect-video h-[50vh] w-auto post-item-image z-50"
            />
          </div>
        );
      })
    }
    
</script>
</Layout>
